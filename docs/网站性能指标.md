# 网站性能指标

目前没有一种单一的指标或测试可以量化用户的“感受”。但是，有一些指标可以作为“有用的指示”：

## 绘制相关

- 首次绘制-FP：第一次绘制运算开始的时间。请注意，这种变化可能是不可见的；它可以是简单的背景颜色更新，也可以是更不那么显眼的内容。
- 首次内容绘制-FCP：第一次重要渲染（例如文本、前景或背景图像、画布或 SVG 等）开始的时间。注意，这些内容不一定是有用或有意义的。
- 首次有效绘制（首次有意义绘制）-FMP：有用的内容渲染到屏幕上的时间，是在发生最大的首屏布局更改与 Web 字体加载后进行的绘制。
- 最大内容绘制-LCP：提供了在视口内可见的最大图像或文本块的渲染时间（从页面开始加载时开始记录）。

## 速度指数-SI

视口中可见的最大内容元素的渲染时间。

## 可交互时间-TTI

UI 可用于用户交互的时间（即加载过程中最后一个长任务完成的时间）。

## 重点关注的指标（用户为中心的新型性能指标）
### LCP
Largest Contentful Paint (LCP)-最大内容绘制，他是一项最要的指标，用于衡量用户感知的加载速度，因为它会将网页主要内容可能已加载的时间点标记在网页加载时间轴中。LCP 时间越短，有助于让用户确信网页有用。  
过去，衡量网页主要内容加载和对用户可见的速度一直是网络开发者面临的一项挑战。load 或 DOMContentLoaded 等旧版指标效果不佳，因为它们不一定与用户在屏幕上看到的内容相对应。  
根据 W3C 网站性能工作组的讨论和 Google 开展的研究，衡量网页主要内容的加载时间时，更准确的方法是查看渲染最大的元素的时间。

什么是LCP：LCP 会报告视口中可见的最大图片、文本块或视频的渲染时间（相对于用户首次导航到网页的时间）。  

LCP 得分多少算好？为了提供良好的用户体验，网站应尽力使 Largest Contentful Paint 不超过 2.5 秒。为确保大多数用户都能达到此目标值，一个合适的衡量阈值是网页加载时间的第 75 个百分位数。
![LCP多少分算好](/LCP多少分算好.png)

最大内容渲染时间的元素类型包括：
- `<img>` : 第一帧呈现的时间
- `<svg>` 元素中的 `<image>` 元素
- `<video>` 元素：第一帧呈现时间
- 使用 url() 函数加载背景图片的元素
- 包含文本节点或其他内嵌级文本元素子元素的块级元素。

确定元素的大小？针对 LCP 报告的元素的尺寸通常是用户在视口内可见的尺寸。如果元素超出视口范围，或者元素的任何部分被剪裁或具有不可见的溢出，则这些部分不会计入元素的大小。  
- 对于已根据固有尺寸调整大小的图片元素，报告的尺寸是可见尺寸或固有尺寸（以较小者为准）。
- 于文本元素，LCP 仅考虑可包含所有文本节点的最小矩形。
- 对于所有元素，LCP 不会考虑使用 CSS 应用的外边距、内边距或边框。

详情见：

### CLS
Cumulative Layout Shift (CLS) ：意外的布局偏移可能会以多种方式干扰用户体验，例如，如果文本突然移动，会导致用户在阅读时迷失位置，或者导致用户点击错误的链接或按钮。在某些情况下，这可能会造成严重损害。累计布局偏移 (CLS) 指标可衡量真实用户发生此问题的频率，从而帮助您解决此问题。

什么是CLS？CLS 用于衡量在网页的整个生命周期内发生的每一次意外布局偏移的布局偏移得分的最高累计分数。布局偏移由 Layout Instability API 定义，该 API 会在视口内可见的元素在两帧之间更改其起始位置

- 每当可见元素从一个呈现帧更改到下一个呈现帧时，都会发生布局偏移。（本指南稍后会详细介绍如何计算各个布局偏移分数。）
- 大量布局偏移（称为会话窗口）是指一个或多个单独的布局偏移快速连续发生，每次偏移之间间隔不到 1 秒，并且总窗口时长不超过 5 秒。
- 最严重的突发是指会话时段内所有布局偏移的累计分数最高的时段。

CLS理想分？  
为了提供良好的用户体验，网站应尽力使 CLS 得分不高于 0.1。为确保大多数用户都能达到此目标值，一个合适的衡量阈值是网页加载时间的第 75 个百分位数  

![CLS多少分算好](/CLS多少分算好.png)  

### INP
良好的响应能力意味着网页对互动做出快速响应。当网页响应互动时，浏览器会在其绘制的下一帧中提供视觉反馈。  
INP 的目的不是衡量互动的最终影响（例如网络提取和其他异步操作的界面更新），而是衡量下一次绘制被阻塞的时间。延迟视觉反馈可能会给用户造成网页响应速度不够快的印象，而 INP 旨在帮助开发者衡量这部分用户体验。

什么是INP？INP 是一项指标，通过观察用户访问网页期间发生的所有点击、点按和键盘互动的延迟时间，评估网页对用户互动的总体响应情况。  

INP 得分怎样才算理想？
- INP 低于或等于 200 毫秒表示网页响应速度良好。
- 如果 INP 高于 200 毫秒或低于 500 毫秒，则表示网页的响应速度需要改进。
- INP 超过 500 毫秒表示网页响应缓慢。

互动性的主要驱动因素通常是 JavaScript，但浏览器确实可以通过不依赖 JavaScript 的控件（例如复选框、单选按钮和 CSS 控件）提供互动性。  

就 INP 而言，系统仅观察到以下互动类型：
- 使用鼠标点击。
- 在带触摸屏的设备上点按。
- 按实体键盘或屏幕键盘上的按键。


### TTFB
TTFB 是一个指标，用于衡量请求资源到响应第一个字节开始到达之间的时间。
![TTFB](/TTFB.png)
  

- TTFB 是以下请求阶段的总和：
- 重定向时间
- Service Worker 启动时间（如果适用）
- DNS 查找
- 连接和 TLS 协商
- 请求，直到收到响应的第一个字节为止

缩短连接设置时间和后端延迟时间可以降低 TTFB。  
TTFB理想分？由于 TTFB 会先于以用户为中心的指标（例如 First Contentful Paint (FCP) 和 Largest Contentful Paint (LCP)），因此建议您的服务器对导航请求做出足够快速的响应。一般而言，大多数网站应力求将 TTFB 控制在 0.8 秒或更短。
![ttfb理想分](/TTFB理想分.png)

### FCP
首次内容绘制 (FCP) 用于衡量从用户首次导航到网页到网页内容的任何部分在屏幕上呈现的时间。对于此指标，“内容”是指文本、图片（包括背景图片）、 `<svg>` 元素或非白色 `<canvas>` 元素。
![FCP](/FCP.png)
在上图描绘的加载时间轴中，FCP 发生在第二帧中，即第一个文本和图片元素渲染到屏幕上时。  
虽然部分内容已呈现，但并非所有内容都已呈现。这是 First Contentful Paint 与 Largest Contentful Paint (LCP) 之间的重要区别，后者旨在衡量网页的主要内容何时完成加载。  
  
FCP 得分多少算好？为了提供良好的用户体验，网站应尽量将首次有意义的绘制时间控制在 1.8 秒或更短的时间。  


**如何提高FCP**  
![如何提高FCP](/如何提高FCP.png)

### TBT
总阻塞时间 (TBT) 指标用于衡量在 First Contentful Paint (FCP) 之后主线程被阻塞的时间足以阻止输入响应的总时间。  
每当存在长任务（即在主线程上运行超过 50 毫秒的任务）时，主线程都会被视为“阻塞”。我们之所以说主线程处于“阻塞”状态，是因为浏览器无法中断正在执行的任务。因此，如果用户在长时间运行的任务过程中与网页互动，浏览器必须等待任务完成后才能响应。  
如果任务时间足够长（超过 50 毫秒），用户很可能会注意到延迟，并认为网页运行缓慢。  


好的 TBT 分数是多少？为了提供良好的用户体验，网站应力求将总阻塞时间控制在 200 毫秒以内。  
**如何提高**
主要以减少阻塞脚本的数量为主：
- 优化耗时较长的任务
- 降低第三方代码的影响
- 缩短 JavaScript 执行时间
- 最大限度地减少主线程工作
- 请保持较低的请求数量和较小的传输大小

[更多性能指标详解请关注web开发完全指南](https://web.dev/explore/metrics?hl=zh-cn)