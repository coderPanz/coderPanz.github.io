# 作用域和作用域链

## 作用域

在JS中，作用域表示变量和表达式可被访问的范围。

### 为什么需要作用域

- 安全：确保变量的安全，变量只能在特定的区域内才能被访问，有了作用域我们就可以避免在程序其它位置意外对某个变量做出修改。
- 减轻命名压力：即在不同的作用域下面可以定义相同的变量名。或者说是避免污染全局变量。

### 作用域类型

- 全局作用域：表示变量可访问的范围是整个程序下的任意位置。在全局作用域下声明的变量成为全局变量，任何不在函数中或是大括号中（for循环/if判断等）声明的变量称为全局变量。
- 函数作用域：在函数内部声明的变量只能在函数内部访问，函数作用域也叫局部作用域，函数内部声明的变量也叫局部变量。
- 块级作用域：ES6引入的let/const 关键字在代码块中(大括号中，例如for遍历中，if语句中)声明后会形成块级作用域，外部无法访问块级作用域中的变量。

### 作用域的嵌套

函数的嵌套使用或者嵌套for/if语句且在其中使用了let/const。

```js
function foo() {
  let a = 1
  function bar() {
    let b = 2
    return a + b
  }
  return bar()
}
```



### 词法作用域

词法作用域也叫静态作用域，指的是作用域在编译阶段就已经确定了变量和函数的作用域，与函数在何处调用无关。

```js
let num = 1;
function printNum() {
  console.log(num);
}
function outputNum() {
  let num = 2;
  printNum();
}

outputNum(); // 1
```



### 作用域链

作用域链是指在当前作用域无法找到一个变量或函数时，会沿着嵌套的作用域向上查找，直到找到为止。这个根据作用域查找过程形成的链式结构叫做作用域链！



### 词法环境

词法环境是一个存储变量和函数声明的数据结构。

具体来说，词法环境由两个主要部分组成：

1. 环境记录：环境记录是一种记录变量和函数声明的数据结构。它可以是对象环境记录或声明式环境记录。
   - 对象环境记录：使用对象来存储变量和函数声明。全局环境和通过 `with` 语句创建的环境使用对象环境记录。
   - 声明式环境记录：使用特定的数据结构来存储变量和函数声明。函数和块级作用域使用声明式环境记录。
2. 外部环境引用：指向外层词法环境的引用。**它用于实现词法作用域和作用域链。**外部环境引用形成了一个链式结构，**使得内部环境可以访问外部环境中的变量和函数**。

当在 JavaScript 代码中执行一个函数或块级作用域时，会创建一个新的词法环境。这个新的词法环境会包含一个环境记录和一个外部环境引用。在词法环境中，变量和函数声明会被存储在环境记录中，并可以通过作用域链的方式进行访问。