# 浏览器的进程架构

## 进程和线程

在计算机原理中，进程的概念是**CPU资源分配**的最小单位（拥有资源和独立运行程序的最小单位，多个进程之间不存在共资源共享）

线程的概念是**CPU调度**的最小单位（线程是进程内的一个执行单元，它共享了所属进程的地址空间和资源，包括内存、文件描述符等。一个进程可以包含一个或多个线程，这些线程共享进程的资源，但每个线程拥有独立的执行路径和栈空间。）

关系：

- **一个进程可以包含多个线程**：在一个进程内部，可以创建多个线程来执行不同的任务，这些线程共享进程的资源，如内存空间和文件句柄，但每个线程拥有独立的执行路径和栈空间。
- **线程程是进程的执行单元**：线程是进程中真正执行任务的单位，进程本身只是一个容器，负责提供资源和环境给线程执行。
- **线程的切换开销相比进程更小**：由于线程共享了进程的地址空间和资源，线程的切换开销通常比进程的切换开销更小，因为不需要切换内存空间和其他资源。

多线程使得程序可以并发执行多个任务，提高了程序的性能和响应速度。

## 浏览器进程线程

​		现代浏览器是**多进程多线程的**，浏览器每新开一个页签，系统相当于创建了一个独立的进程，进程中又有多线程，每个线程负责不同的任务，以确保浏览器的性能和稳定性。 

### 浏览器中的进程

1. **主进程（Browser进程）**：
   - 主进程是浏览器启动时首先创建的进程，负责管理浏览器的整体运行。它负责创建和管理其他进程，以及处理用户界面、网络请求、文件访问等任务。
2. **渲染进程（Renderer 进程-多线程）**：
   - 渲染进程负责将网页内容渲染到用户的屏幕上，并处理与网页相关的任务。每个标签页通常都有一个独立的渲染进程，以确保页面之间的隔离性。渲染进程包括了**样式计算**、**布局**、**绘制**、**JavaScript脚本执行**等步骤，最终生成用户可见的页面。
3. **GPU进程（GPU 进程）**：
   - GPU进程负责处理与图形相关的任务，如页面的硬件加速渲染、视频播放、3D动画等。将这些任务交给GPU进程可以**减轻主进程和渲染进程的负担，提高页面的渲染性能。**
4. **网络进程（Network 进程）**：
   - 网络进程负责处理浏览器的网络请求和响应。当用户访问网页、下载文件或发送请求时，网络进程会负责**发送请求、接收响应，并将数据传递给渲染进程或其他相关进程。**
5. **插件进程（Plugin 进程）**：
   - 插件进程负责运行浏览器中的插件，如Flash、Silverlight等。由于插件可能存在安全漏洞或稳定性问题，将插件运行在独立的进程中可以提高浏览器的安全性和稳定性。
6. **扩展进程（Extension Process）**：
   - 扩展进程负责运行浏览器扩展（Extension）的相关任务。类似于插件进程，将扩展运行在独立的进程中可以提高浏览器的安全性和稳定性。



​		每个进程都有其特定的任务和责任，通过将这些任务分配给不同的进程，浏览器可以实现更高的并发性、更好的安全性和更好的稳定性。此外，浏览器通常会采取一些优化策略，如进程复用、进程间通信等，以提高性能和资源利用率。



### 浏览器多线程

线程主要存在于渲染

1. **GUI渲染线程（Rendering Thread）**：
   - 渲染线程负责将网页内容渲染到用户的屏幕上。它包括了**样式计算、布局和绘制**等步骤，与JS引擎互斥，当执行JS引擎线程时，GUI会pending（等待状态），当前任务队列空闲时，才会继续执行GUI。
2. **JS引擎线程**
   - 也称为JS内核，负责处理javascript脚本程序，JS引擎等待任务队列中任务的到来，然后加以处理，并且浏览器只开辟了这一个线程来执行JS代码。
3. **网络线程（io线程）（Network Thread）**：
   - 网络线程负责处理网络请求和响应。当浏览器需要加载资源时（如HTML、CSS、JavaScript文件、图像等），网络线程会发送请求并接收响应，然后将资源传递给渲染引擎或其他线程进行处理。
4. **事件线程（Event Thread）**：
   - 事件线程负责管理用户交互事件，如鼠标点击、键盘输入、页面滚动等。当事件发生时，事件线程会将事件添加到事件队列中，然后由JS线程按顺序处理这些事件。
5. **定时器线程（Timer Thread）**：
   - setInterval、setTimeOut所在线程，所以setInterval、setTimeOut其实并不属于JS语言里的api，定时器线程负责管理JavaScript中的定时器和计时器。它会在指定的时间间隔后触发定时器回调函数，并将其添加到事件队列中，以便由JS线程执行。
6. **工作线程（Worker Thread）**：
   - 工作线程是在HTML5中引入的概念，允许在后台执行耗时的任务，而不会阻塞主线程。工作线程可以独立运行，并且可以与主线程进行通信，以便在后台执行复杂的计算或处理大量数据。
7. **存储线程（Storage Thread）**：
   - 存储线程负责管理浏览器的本地存储，如LocalStorage和IndexedDB。它负责读取和写入本地存储数据，并确保数据的安全性和一致性。

​		以上是浏览器中常见的线程类型，它们协同工作以实现快速、稳定和高效的浏览器体验。理解这些线程的作用和相互关系有助于开发者优化网页性能和改善用户体验。进程里面，也就是我们常说的浏览器内核里面，浏览器内核中的几种引擎便是我们的主要使用到的线程，那么接下来看看渲染进程中主要都包含了哪些线程。